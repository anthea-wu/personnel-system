# Leave Application 重構計劃

## 🔍 潛在問題分析

**你可能沒注意到的問題：**
1. **單一組件過於龐大（590行）** - 違反單一職責原則，難以維護和測試
2. **大量內聯樣式** - 造成程式碼混亂，難以統一管理樣式
3. **複雜的時間選擇邏輯** - 邏輯散亂在各處，容易出錯且難以重用
4. **表單驗證規則過於複雜** - zod schema 太長，難以閱讀和維護
5. **API 呼叫邏輯混在組件中** - 不利於錯誤處理和重用

## 📋 重構計劃 TODO

### 1. **類型與驗證分離** (高優先級)
- 抽離 `TIME_TYPE` enum 到 `src/types/leave.ts`
- 將 zod schema 拆分成更小的可重用片段
- 建立清晰的 TypeScript 類型定義

### 2. **複雜 UI 組件化** (高優先級)
- **TimeSelector 組件**: 處理指定時間的複雜選擇邏輯（目前363-524行）
- **DateRangeSelector 組件**: 處理日期範圍選擇和同步邏輯
- **LeaveTypeSelector 組件**: 處理假別選擇

### 3. **邏輯抽離到 Custom Hook** (高優先級)
- 建立 `useLeaveApplication` hook 處理：
  - 表單狀態管理
  - API 呼叫邏輯
  - 提交狀態和錯誤處理

### 4. **樣式統一化** (中優先級)
- 移除所有內聯 `style` 屬性
- 使用 MUI 的 `sx` prop 或 styled-components
- 建立可重用的樣式常數

### 5. **表單驗證優化** (中優先級)
- 將複雜的 `.refine()` 邏輯分離成獨立的驗證函數
- 提高驗證邏輯的可讀性和可測試性

## 🎯 預期效果

重構後將獲得：
- **可維護性提升**: 每個組件職責單一，易於修改
- **可測試性提升**: 邏輯分離後更容易進行單元測試
- **可重用性提升**: 組件可在其他頁面重用
- **程式碼可讀性**: 主組件邏輯清晰，不再冗長

## 📝 實施順序

1. ✅ 建立 TimeSelector 組件處理指定時間的複雜邏輯
2. ✅ 建立 DateRangeSelector 組件處理日期範圍選擇邏輯  
3. ✅ 建立 LeaveTypeSelector 組件處理假別選擇
4. ✅ 建立 useLeaveApplication custom hook 處理表單狀態和 API 呼叫
5. ✅ 將類型與驗證分離到獨立檔案
6. ✅ 重構主組件，使用新的子組件和 hook
7. ✅ 將內聯樣式重構為 sx prop 統一管理
8. ✅ 建立 SubmitButton 組件處理提交狀態和 loading
9. ✅ 建立 FormMessage 組件統一處理成功/錯誤訊息顯示
10. ✅ 優化表單驗證邏輯，將複雜的 refine 邏輯分離成獨立函數